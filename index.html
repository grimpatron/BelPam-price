<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8" />
  <title>–°—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã ‚Üí —Ç–µ–∫—Å—Ç –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="style-bp.css">
</head>

<body>
  <!-- <header>
    <h1>–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã ‚Üí —Ç–µ–∫—Å—Ç</h1>
  </header> -->

  <div class="container">
    <section class="card">
      <header>
        <h2>–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
      </header>
      <div class="content">
        <label>–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ —Å—Ç—Ä–æ–∫—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã Excel</label>
        <textarea id="row" class="mono"></textarea>

        <div class="addition">
          <div class="addition-block">
            <label><input type="checkbox" id="check-delivery">–î–æ–≤–æ–∑</label>
            <label><input type="checkbox" id="check-MZL">–ì—Ä—É–∑ –≤ –ú–∞–Ω—å—á–∂—É—Ä–∏–∏</label>
            <label><input type="checkbox" id="check-adr">ADR –∞–≤—Ç–æ</label>
            <label><input type="checkbox" id="check-adr9">ADR –≥—Ä—É–∑ (2 —Ü–µ–Ω—ã)</label>
          </div>
          <div class="addition-block">
            <label><input type="checkbox" id="check-dimensions">–ù–µ—Ç —Ç–æ—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤</label>
            <label><input type="checkbox" id="check-stackable">–°—á–∏—Ç–∞–ª –∫–∞–∫ —à—Ç–∞–± (‚úÖ)</label>
            <label><input type="checkbox" id="check-non-stackable">–°—á–∏—Ç–∞–ª –∫–∞–∫ –Ω–µ —à—Ç–∞–± (‚ùå)</label>
            <label><input type="checkbox" id="check-temperature">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π —Ä–µ–∂–∏–º (üå°Ô∏è)</label>
          </div>
          <div class="relevance-block">
            <span>–î–µ–π—Å—Ç–≤–∏–µ —Å—Ç–∞–≤–∫–∏: </span>
            <input class="relevance-radio" type="radio" name="relevance" id="one-day-relevance">
            <label class="relevance-label" for="one-day-relevance">1 –¥–µ–Ω—å</label>
            <input class="relevance-radio" type="radio" name="relevance" id="three-day-relevance" checked>
            <label class="relevance-label" for="three-day-relevance">3 –¥–Ω—è</label>
            <input class="relevance-radio" type="radio" name="relevance" id="five-day-relevance">
            <label class="relevance-label" for="five-day-relevance">5 –¥–Ω–µ–π</label>
            <input class="relevance-radio" type="radio" name="relevance" id="seven-day-relevance">
            <label class="relevance-label" for="seven-day-relevance">7 –¥–Ω–µ–π</label>
            <label class="label-epi"><input type="checkbox" id="check-EPI" checked>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∑–∞ –≠–ü–ò</label>
          </div>
        </div>

        <div class="btns">
          <button class="transform-button" onclick="transform()">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å</button>
          <button class="reset-button" onclick="resetAll()">–°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
      </div>
    </section>

    <section class="card">
      <header>
        <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç</h2>
      </header>
      <div class="content">
        <div id="out" class="preview mono">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ç–µ–∫—Å—Ç.</div>
        <div class="btns"><button onclick="copyOut()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button></div>
      </div>
    </section>
  </div>

  <div id="toast"></div>

  <script>
    function detectSep(s) {
      const counts = {
        '\t': (s.match(/\t/g) || []).length,
        ';': (s.match(/;/g) || []).length,
        ',': (s.match(/,/g) || []).length,
        '|': (s.match(/\|/g) || []).length,
      };
      let best = '\t', max = counts['\t'];
      for (const k of [';', ',', '|']) {
        if (counts[k] > max) { max = counts[k]; best = k; }
      }
      return max > 0 ? best : null;
    }

    function parseRow(raw, sepMode, doTrim) {
      let sep = sepMode === 'auto' ? detectSep(raw) : sepMode;
      if (!sep) sep = '\t';
      let parts = raw.split(sep);
      if (doTrim === 'yes') parts = parts.map(p => p.trim());
      return parts;
    }

    // --- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —è—á–µ–µ–∫ ---
    function handleCode(cell) { return /^\d{1,2}-\d{1,2}$/.test(cell) ? cell : ''; }
    function handleCompany(cell) {
      const matches = cell.match(/\((.*?)\)/g);

      if (matches) {
        const extractedText = matches.map(m => m.slice(1, -1)); // –£–±–∏—Ä–∞–µ–º —Å–∫–æ–±–∫–∏
        return extractedText;
      }
    }
    function handlePrice(cell) { return cell }
    function handleSvh(cell) {
      // if (/–°–í–•/i.test(cell)) return cell.replace(/–°–í–•\s+–ë–æ–±—Ä—É–π—Å–∫/ig, '–°–í–• –ë–æ–±—Ä—É–π—Å–∫–∞');
      return cell;
    }

    function handleTransit(cell) {
      cell = cell.trim();
      const numbers = cell.match(/\d+/g);
      if (!numbers) return cell;

      const number = parseInt(numbers[numbers.length - 1], 10);
      const lastDigit = number % 10;
      const lastTwoDigits = number % 100;

      let suffix;
      if (lastDigit === 1 && lastTwoDigits !== 11) {
        suffix = "–¥–µ–Ω—å";
      } else if ([2, 3, 4].includes(lastDigit) && ![12, 13, 14].includes(lastTwoDigits)) {
        suffix = "–¥–Ω—è";
      } else {
        suffix = "–¥–Ω–µ–π";
      }

      return cell.replace(/\s*(–¥–µ–Ω—å|–¥–Ω—è|–¥–Ω–µ–π)?$/i, "") + " " + suffix;
    }

    function getTodayDate() {
      const today = new Date();

      const day = String(today.getDate()).padStart(2, '0');
      const month = String(today.getMonth() + 1).padStart(2, '0');
      const year = today.getFullYear();

      return `${day}.${month}.${year}`;
    }


    // –∫–∞—Ä—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–π –ø–æ –∏–Ω–¥–µ–∫—Å–∞–º
    const cellHandlers = {
      1: handleCode,     // —è—á–µ–π–∫–∞ ‚Ññ1 ‚Äî –Ω–æ–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞
      6: handleCompany,  // —è—á–µ–π–∫–∞ ‚Ññ4 ‚Äî –∑–∞–∫–∞–∑—á–∏–∫
      8: handleSvh,      // —è—á–µ–π–∫–∞ ‚Ññ6 ‚Äî –°–í–•
      16: handlePrice,   // —è—á–µ–π–∫–∞ ‚Ññ12 ‚Äî —Ü–µ–Ω–∞
      17: handleTransit  // —è—á–µ–π–∫–∞ ‚Ññ13 ‚Äî —Ç—Ä–∞–Ω–∑–∏—Ç
    };

    function transform() {
      const raw = document.getElementById('row').value;
      if (!raw.trim()) {
        document.getElementById('out').textContent = '–í–≤–µ–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –∏–∑ —Ç–∞–±–ª–∏—Ü—ã.';
        return;
      }

      const parts = parseRow(raw);
      let collected = { code: '', price: '', svh: '', transit: '' };

      parts.forEach((cell, idx) => {
        if (cellHandlers[idx]) {
          const res = cellHandlers[idx](cell);
          if (idx === 1) collected.code = res;
          if (idx === 6) collected.company = res;
          if (idx === 8) collected.svh = res;
          if (idx === 16) collected.price = res;
          if (idx === 17) collected.transit = res;
        }
      });

      const lines = [];
      if (collected.code) lines.push(`${collected.code} (${collected.company})`);
      if (document.getElementById('check-adr9').checked) {
        if (collected.price || collected.svh || collected.transit) {
          const destText = collected.svh ? `–¥–æ ${collected.svh}` : '';
          lines.push(`${collected.price ? collected.price + ' USD' : ''} ${destText} –µ—Å–ª–∏ —É–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞ –∏–º–µ–µ—Ç –∑–Ω–∞–∫–∏, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∏–µ —á—Ç–æ –≥—Ä—É–∑ –æ–ø–∞—Å–Ω—ã–π, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º ADR –∞–≤—Ç–æ–º–æ–±–∏–ª—å –ø–æ –ö–∏—Ç–∞—é.`);
          lines.push(`__ USD ${destText} –µ—Å–ª–∏ —É–ø–∞–∫–æ–≤–∫–∞ –≥—Ä—É–∑–∞ –Ω–µ –∏–º–µ–µ—Ç –∑–Ω–∞–∫–æ–≤, –æ–±–æ–∑–Ω–∞—á–∞—é—â–∏—Ö —á—Ç–æ –≥—Ä—É–∑ –æ–ø–∞—Å–Ω—ã–π, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –∫–∏—Ç–∞–π—Å–∫–∏–π —Å–≤–æ–∑ –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å –≤ –æ–±—ã—á–Ω–æ–º –∞–≤—Ç–æ.`);
          const transitText = collected.transit ? ` –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏ ${collected.transit}.` : '';
          lines.push(`*${transitText}`);
        }
      } else {
        if (collected.price || collected.svh || collected.transit) {
          const destText = collected.svh ? `–¥–æ ${collected.svh}` : '';
          const transitText = collected.transit ? ` –¢—Ä–∞–Ω–∑–∏—Ç–Ω—ã–µ —Å—Ä–æ–∫–∏ ${collected.transit}.` : '';
          lines.push(`${collected.price ? collected.price + ' USD' : ''} ${destText}.${transitText}`);
        }
      }
      if (document.getElementById('check-dimensions').checked) { lines.push("* –°—Ç–∞–≤–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç —Ç–æ—á–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –≥—Ä—É–∑–∞. –ö–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è —Ä–∞–∑–º–µ—Ä—ã, —Å—Ç–∞–≤–∫–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞."); }
      if (document.getElementById('check-adr').checked) { lines.push("* –í —Å—Ç–∞–≤–∫—É –≤–∫–ª—é—á—ë–Ω–∞ —Å—Ç–æ–∏–º–æ—Å—Ç—å –∞–≤—Ç–æ–º–æ–±–∏–ª—è –¥–ª—è –ø–µ—Ä–µ–≤–æ–∑–∫–∏ –æ–ø–∞—Å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤ (ADR)."); }
      if (document.getElementById('check-temperature').checked) { lines.push("* –ê–≤—Ç–æ–º–æ–±–∏–ª—å —Å —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–º —Ä–µ–∂–∏–º–æ–º –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–º —Å–∫–ª–∞–¥–µ –≤–∫–ª—é—á–µ–Ω—ã –≤ —Å—Ç–∞–≤–∫—É."); }
      if (document.getElementById('check-stackable').checked) { lines.push("* –ì—Ä—É–∑ —Å—á–∏—Ç–∞–ª—Å—è –∫–∞–∫ —à—Ç–∞–±–µ–ª–∏—Ä—É–µ–º—ã–π."); }
      if (document.getElementById('check-non-stackable').checked) { lines.push("* –ì—Ä—É–∑ —Å—á–∏—Ç–∞–ª—Å—è –∫–∞–∫ –Ω–µ —à—Ç–∞–±–µ–ª–∏—Ä—É–µ–º—ã–π."); }
      if (document.getElementById('check-MZL').checked) { lines.push("* –°—Ç–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏ –≥—Ä—É–∑–∞ –Ω–∞ —Å–∫–ª–∞–¥ –Ω–∞—à–µ–≥–æ –∞–≥–µ–Ω—Ç–∞. –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º —Å–≤–æ–∑ –Ω–∞—à–∏–º–∏ —Å–∏–ª–∞–º–∏, —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω–∞."); }
      if (document.getElementById('check-delivery').checked) { lines.push("* –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ–≤–æ–∑–∞ –≤–∫–ª—é—á–µ–Ω–∞ –≤ —Å—Ç–∞–≤–∫—É."); }


      const selectedRadio = document.querySelector('input[name="relevance"]:checked');
      if (selectedRadio) {
        const today = getTodayDate();
        switch (selectedRadio.id) {
          case 'one-day-relevance': lines.push(`* –°—Ç–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ –¥–µ–Ω—å –ø—Ä–æ—Å—á—ë—Ç–∞ (${today}).`); break;
          case 'three-day-relevance': lines.push(`* –°—Ç–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3—Ö –¥–Ω–µ–π (—Å ${today}).`); break;
          case 'five-day-relevance': lines.push(`* –°—Ç–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 5–∏ –¥–Ω–µ–π (—Å ${today}).`); break;
          case 'seven-day-relevance': lines.push(`* –°—Ç–∞–≤–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 7–∏ –¥–Ω–µ–π (—Å ${today}).`); break;
        }
      }
      if (document.getElementById('check-EPI').checked) { lines.push(`* –ï—Å–ª–∏ –≥—Ä—É–∑ —Å—Ç–æ–∏—Ç –¥–æ—Ä–æ–∂–µ 50000 USD, –º—ã –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º 50 USD –∑–∞ –≠–ü–ò, –∞ –≤—Å—ë, —á—Ç–æ —Å–≤–µ—Ä—Ö—É –ø–æ –∫–≤–∏—Ç–∞–Ω—Ü–∏–∏, –≤—ã—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ –æ–ø–ª–∞—Ç—É –∫–ª–∏–µ–Ω—Ç—É.`); }
      document.getElementById('out').textContent = lines.join('\n');
    }

    function resetAll() {
      document.getElementById('row').value = '';
      document.getElementById('check-dimensions').checked = false;
      document.getElementById('check-MZL').checked = false;
      document.getElementById('check-adr').checked = false;
      document.getElementById('check-adr9').checked = false;
      document.getElementById('check-delivery').checked = false;
      document.getElementById('check-stackable').checked = false;
      document.getElementById('check-temperature').checked = false;
      document.getElementById('check-non-stackable').checked = false;
      document.getElementById('row').focus();
      document.getElementById('out').textContent = '–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è —Ç–µ–∫—Å—Ç.';
    }

    function showToast(message, isError = false) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.className = "toast" + (isError ? " error" : "");
      toast.classList.add("show");

      setTimeout(() => {
        toast.classList.remove("show");
      }, 1200);
    }

    async function copyOut() {
      const text = document.getElementById('out').textContent;
      try {
        await navigator.clipboard.writeText(text);
        showToast("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");
      } catch {
        showToast("–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å!", true);
      }
    }

  </script>
</body>

</html>
<!-- + –¥–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –∫–æ–≥–¥–∞ –±—ã–ª–∞ –¥–∞–Ω–∞ —Å—Ç–∞–≤–∫–∞ -->
<!-- + quality of life (—Ñ–æ–∫—É—Å –Ω–∞ —Å—Ç—Ä–æ–∫–µ –≤–≤–æ–¥–∞, —É–±—Ä–∞–ª alert) -->
<!-- + –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —à–∞–±–ª–æ–Ω–æ–≤ (–ê–î–†, –†–ï–§, –ë—Ä–µ–Ω–¥, –î–æ–≤–æ–∑, –®—Ç–∞–±) -->
<!-- + –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä —Å—Ä–æ–∫–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏ —Å—Ç–∞–≤–∫–∏ -->